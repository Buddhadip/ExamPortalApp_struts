package com.exam.dao;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.SQLException;

public class UserDAO {
	 private String jdbcURL;
	    private String jdbcUsername;
	    private String jdbcPassword;
	    private Connection conn;

	    public UserDAO() {
	        this.jdbcURL = "jdbc:mysql://localhost:3306/exam_master";
	        this.jdbcUsername = "root";
	        this.jdbcPassword = "root";
	    }

	    // Establishes a database connection
	    protected void connect() throws SQLException {
	        if (conn == null || conn.isClosed()) {
	            try {
	                Class.forName("com.mysql.cj.jdbc.Driver");
	            } catch (ClassNotFoundException e) {
	                throw new SQLException(e);
	            }
	            conn = DriverManager.getConnection(jdbcURL, jdbcUsername, jdbcPassword);
	        }
	    }

	    // Closes the database connection
	    protected void disconnect() throws SQLException {
	        if (conn != null && !conn.isClosed()) {
	            conn.close();
	        }
	    }
	    
	    public boolean addUser( String name, String email, String roll, String urole ) throws SQLException {
	    	connect(); 
	            // Check if the urole field is empty or null
	            if (urole == null || urole.isEmpty()) {
	                // Set the default value to "student"
	                urole = "student";
	            }
	            
	            // Create the SQL query to insert the record into the table
	            String query = "INSERT INTO your_table_name (name, email, roll, urole) VALUES (?, ?, ?, ?)";
	            
	            // Prepare the statement
	            PreparedStatement stmt = conn.prepareStatement(query);
	            
	            // Set the values for the placeholders
	            stmt.setString(1, name);
	            stmt.setString(2, email);
	            stmt.setString(3, roll);
	            stmt.setString(4, urole);
	            
	            // Execute the query
	            int rowsAffected = stmt.executeUpdate();
	            
	            // Check if the insertion was successful
	            if (rowsAffected > 0) {
	                return true;
	            }

	        // If the insertion failed or an exception occurred
	            stmt.close();
	            disconnect();
	        return false;
	    }
//===============================================================================================//	    
	    public boolean registerUser( String name, String email, String roll, String urole ) throws SQLException{
	    	connect(); 
            
            String query = "INSERT INTO user(name, email, roll, urole) VALUES (?, ?, ?, ?)";
            PreparedStatement stmt = conn.prepareStatement(query);
            
            stmt.setString(1, name);
            stmt.setString(2, email);
            stmt.setString(3, roll);
            stmt.setString(4, urole);

            int rowsAffected = stmt.executeUpdate();

            if (rowsAffected > 0) {
                return true;
            }

            stmt.close();
            disconnect();
        return false;
	    }
}
